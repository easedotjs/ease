{
  "version": 3,
  "sources": ["index.js"],
  "sourcesContent": ["// TODO: Add event emitters for route changes, argument changes, etc.\nif (!ease) {\n  throw new Error('This library requires Ease to be loaded first')\n}\n\nlet root = ease.config.router?.root || ''\n\nlet router = {\n  route: null,\n  args: {},\n  listeners: [],\n  push(path) {\n    this._navigate(path);\n    window.history.pushState({}, '', path);\n  },\n  replace(path) {\n    this._navigate(path);\n    window.history.replaceState({}, '', path);\n  },\n  _navigate(path) {\n    let resolvedPath = this._resolvePath(path);\n    let [newRoute, newArgs] = resolvedPath.split('?');\n\n    this._updateArgs(newArgs);\n\n    // Only navigate if the full path is actually different\n    if (this.route === newRoute) {\n      this._notifyListeners();\n      return;\n    }\n\n    fetch(`${root}${newRoute}`).then((response) => {\n      return response.text()\n    }).then((html) => {\n      const domParser = new DOMParser();\n      const doc = domParser.parseFromString(html, 'text/html')\n      \n      // Get the body content, accounting for templates\n      let body = doc.querySelector('body')\n      if (doc.querySelector('body>template')) {\n        body = doc.querySelector('body>template');\n      }\n\n      // Load new script tags\n      doc.head.querySelectorAll('script').forEach((script) => {\n        if (document.querySelector(`script[src=\"${script.src}\"]`)) return\n        let newScript = document.createElement('script')\n        newScript.src = script.src\n        newScript.type = script.type\n        newScript.async = true\n        document.head.appendChild(newScript)\n      });\n\n      // TODO: Replace with the safer node insertion over innerHTML\n      document.title = doc.querySelector('title').textContent;\n      document.body.innerHTML = body.innerHTML;\n\n      /* Load components that may not have been loaded */\n      doc.head.querySelectorAll('link[rel=\"component\"]').forEach((component) => {\n        let name = component.attributes['name']?.value\n        let href = component.attributes['href']?.value\n        document.dispatchEvent(new CustomEvent('ease_load_component', {detail: { name, href }}))\n      });\n\n      this.route = newRoute;\n\n      // Notify then all listeners\n      this._notifyListeners();\n      this.listeners = [];\n    }).catch((error) => {\n      // Ignore for now to handle jumping to IDs\n    })\n  },\n  _resolvePath(path) {\n    if (path === '/' || path === '') {\n      return 'index'\n    }\n    return path.replace(/^\\//, '')\n  },\n  _updateArgs(args) {\n    this.args = {}\n    if (!args) return\n\n    args.split('&').forEach((arg) => {\n      let [key, value] = arg.split('=')\n      this.args[key] = value\n    })\n  },\n  _notifyListeners() {\n    this.listeners.forEach((listener) => {\n      listener(this.route, this.args)\n    })\n  },\n  onRouteChange(callback) {\n    this.listeners.push(callback);\n    callback(this.route, this.args);\n  },\n  createRoute(path, file) {\n    this.routes.push({path, file})\n  }\n}\n\n// Set initial state for router\nrouter._currentRoute = window.location.pathname.split('?')[0];\nrouter._updateArgs(window.location.search.substring(1));\n\n// Adds a nav-to element that can be used to navigate to different pages\n// In the future, you should be able to use is=\"\" but safari does not support this\nclass LinkToElement extends HTMLElement {\n  constructor() {\n    super();\n  }\n\n  connectedCallback() {\n    const anchor = document.createElement('a');\n    anchor.href = this.getAttribute('href');\n    anchor.textContent = this.textContent;\n\n    this.textContent = '';\n    this.appendChild(anchor);\n\n    anchor.addEventListener('click', (event) => {\n      event.preventDefault();\n      router.push(this.getAttribute('href'));\n    })\n  }\n};\ncustomElements.define('nav-to', LinkToElement);\n\n// Listen for popstate events\nwindow.addEventListener('popstate', () => {\n  router._navigate(window.location.href);\n})\n\n\nease.extensions.add({\n  name: '@easedotjs/router',\n  objects: { router }\n})\n"],
  "mappings": "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",
  "names": ["root", "router", "path", "resolvedPath", "newRoute", "newArgs", "response", "html", "doc", "body", "script", "newScript", "component", "name", "href", "error", "args", "arg", "key", "value", "listener", "callback", "file", "LinkToElement", "anchor", "event"]
}
