(()=>{var L="http://www.w3.org/2000/svg",w=class{name;value;constructor(t,n){this.name=t,this.value=n}},p=class r{#t;#e;#n;#r=void 0;#s=[];constructor(t,n,a,o=[]){this.#t=t,this.#e=n,this.#s.push(...o),this.#r=a}addChild(t){this.#s.push(t),t.setParent(this)}setParent(t){this.#n=t}static fromString(t,n){t=t.replace(">","");let[a,...o]=t.split(" ");a=a.replace("<","").trim();let h=[];o=o.join(" ");let s,c,l=0,u="",e=!1;for(let i=0;i<o.length;i++)if(o[i]==="="&&l===0)s=u,u="",l=1;else if(o[i]==='"')if(l===2){c=u,u="",l=0;let d=new w(s.trim(),c);h.push(d)}else e=!0;else o[i]!=='"'&&l===1?(u+=o[i],l=2):u+=o[i];return a==="svg"?new r(a,h,L):new r(a,h,n)}get parent(){return this.#n}get tag(){return this.#t}get attributes(){return this.#e}get children(){return this.#s}get ns(){return this.#r}toString(){return`<${this.#t}${this.#e.length?" ":""}${this.#e.map(t=>`${t.name}${t.value?`="${t.value}"`:""}`).join(" ")}>${this.#s.map(t=>t.toString()).join("")}</${this.#t}>`}get htmlNode(){let t=this.#r?document.createElementNS(this.#r,this.#t):document.createElement(this.#t);return this.#e.forEach(n=>{t.setAttribute(n.name,n.value.replace(/"/g,""))}),this.#s.forEach(n=>{t.appendChild(n.htmlNode)}),t}},_=class extends p{#t;constructor(t){super("#TEXT",[],[]),this.#t=t}get text(){return this.#t}get htmlNode(){return document.createTextNode(this.#t)}toString(){return this.#t}addChild(){throw new Error("Cannot add children to text node")}},f=class{constructor(){}parse(t){let n=new p("root"),a=n;return t.split(/(<[^>]+>)/).filter(o=>!!o).forEach(o=>{if(!o.startsWith("<!"))if(o.startsWith("</"))a=a.parent;else if(o.startsWith("<")){let h=p.fromString(o,a.ns);a.addChild(h),o.endsWith("/>")||(a=h)}else o.trim().length>0&&a.addChild(new _(o.trim()))}),n}};function C(r){let n=new f().parse(r.match(/<template>([\s\S]*)<\/template>/m)?.[1]||""),a=r.match(/<script>([\s\S]*)<\/script>/m)?.[1]||"",o=r.match(/<style>([\s\S]*)<\/style>/m)?.[1]||"",h=r.match(/<property\s?([^(/>)]+)\/>/g)?.map(s=>{let c=s.match(/name="([^"]+)"/),l=s.match(/type="([^"]+)"/),u=s.match(/default="([^"]+)"/),e=s.match(/required/),i=s.match(/expose-to-styles/),d=s.match(/attribute/),m=c?c[1]:null,$=l?l[1]:null,A=u?u[1]:null,T=e?e[1]==="true":!1;return{name:m,type:$,default:A,required:T,exposeToStyles:!!i,attribute:!!d}})||[];return{template:n,script:a,style:o,properties:h}}if(typeof ease>"u")throw new Error("This library requires Ease to be loaded first");var{warn:H,error:y,info:X}=ease.log,{config:z}=ease,g=new Map;var E=class{template;tagName;script;style;properties;href;constructor(t,n,a,o,h,s){this.href=t,this.template=n,this.tagName=a,this.script=this._scriptBlobFromText(o),this.style=h,this.properties=s}_scriptBlobFromText(t){if(!t)return null;let n=new Blob([t],{type:"text/javascript"});return URL.createObjectURL(n)}};async function v(r,t){if(g.has(r)){let n=g.get(r);if(n.href!==t)throw y(`Component ${r} already exists in the registry with a different href`).toError();return n}return await fetch(`${t}`,{headers:{"x-ease-fetch":"true"}}).then(async n=>({content:await n.text(),code:n.status})).then(({content:n,code:a})=>{if(a!==200)throw y(`Failed to fetch component from ${t}`).toError();let{template:o,script:h,style:s,properties:c}=C(n);return ease.extensions.getExtensionsByArtifact("@easedotjs/components").forEach(([l,u])=>{if(l.onFetchComponent)try{l.onFetchComponent({template:o,script:h,style:s})}catch(e){y(`Failed to run extension ${u} onFetchComponent for ${t}`,e)}}),{template:o,script:h,style:s,properties:c}}).then(({template:n,script:a,style:o,properties:h})=>new E(t,n,r,a,o,h)).catch(n=>{y(`Failed to fetch component from ${t}`)})}function x(r){r&&(g.has(r.tagName)||g.set(r.tagName,r))}if(typeof ease>"u")throw new Error("This library requires Ease to be loaded first");var{config:q,extensions:b}=ease,{error:N}=ease.log;function S(r,t,n,a,o){let h=class extends HTMLElement{_shadow;_mounted=!1;_styleEl;_propStyleEl;_eventListeners=[];_args={root:void 0,elements:{},get el(){return this.elements},properties:{},get props(){return this.properties},extensions:{},get ext(){return this.extensions},get[q.inject.name](){return this.extensions},attributes:{},get attrs(){return this.attributes}};constructor(){super();let s=this;this._shadow=this.attachShadow({mode:"open"}),this._args.root=this._shadow,this._shadow.tagName=r,t.children.forEach(e=>{this._shadow.appendChild(e.htmlNode.cloneNode(!0))}),n&&(this._styleEl=document.createElement("style"),this._styleEl.textContent=n,this._shadow.appendChild(this._styleEl));let c="";o?.forEach?.(e=>{if(this._args.properties[e.name]={_listeners:[],_value:e.default,type:e.type,required:e.required,exposeToStyles:e.exposeToStyles,attribute:e.attribute,get value(){return this._value},set value(i){let d=this._value;this._value=i,this._listeners.forEach(m=>m(i,d)),this.exposeToStyles&&s.updateStyles()},watch(i){this._listeners.push(i),this._mounted||i(this.value,void 0)},unwatch(i){this._listeners=_listeners.filter(d=>d!==i)},unwatchAll(){this._listeners=[]}},Object.defineProperty(this,e.name,{get:()=>this._args.properties[e.name].value,set:i=>{this._args.properties[e.name].value=i}}),e.required&&e.attribute&&!this.hasAttribute(e.name))throw N(`Attribute ${e.name} is required`).toError();e.attribute&&(this._args.properties[e.name].value=this.getAttribute(e.name)||e.default),e.exposeToStyles&&(c+=`--${e.name}: ${this._args.properties[e.name].value}; `)}),c&&(this._propStyleEl=document.createElement("style"),this._propStyleEl.textContent+=`:host { ${c} }`,this._shadow.insertBefore(this._propStyleEl,this._styleEl)),this._shadow.querySelectorAll("[id]").forEach(e=>{this._args.elements[e.id]=e}),this._args.extensions=b.all.reduce((e,i)=>{let d=i.objects||{},m=i.methods||{};return{...e,...d,...m}},{});let l=this._shadow.addEventListener;this._shadow.addEventListener=function(e,i){s._eventListeners.push({name:e,callback:i}),l(e,i)};let u=this._shadow.removeEventListener;this._shadow.removeEventListener=function(e,i){s._eventListeners=s._eventListeners.filter(({name:d,callback:m})=>d===e&&m===i?(u(e,i),!1):!0)},a&&import(a).then(e=>{e.default&&(e.default&&e.default.apply(s,[{...this._args,self:s}]),this._shadow.dispatchEvent(new CustomEvent("connect")))}),b.getExtensionsByArtifact("@easedotjs/components").forEach(([e])=>e.onInit?.({shadow:this._shadow,args:this._args,instance:s})),Array.from(this.attributes).forEach(e=>{this._args.attributes[e.name]=e.value})}updateStyles(){if(!this._propStyleEl)return;let s="";Object.keys(this._args.properties).forEach(c=>{let l=this?.[c];l.exposeToStyles&&(attrStyles+=`--${c}: ${l.value}; `)}),this._propStyleEl.textContent=`:host { ${s} }`}connectedCallback(){this._mounted=!0,this._shadow.dispatchEvent(new CustomEvent("connect"))}disconnectedCallback(){this._mounted=!1,this._args.properties?.forEach?.(s=>{s.unwatchAll()}),this._shadow.dispatchEvent(new CustomEvent("disconnect")),this._eventListeners.forEach(({name:s,callback:c})=>{this._shadow.removeEventListener(s,c)}),b.getExtensionsByArtifact("@easedotjs/components").forEach(([s])=>s.onCleanup?.({shadow:this._shadow,args:this._args}))}static get observedAttributes(){return o.filter(s=>s.attribute).map(s=>s.name)}};return customElements.define(r,h),h}if(typeof ease>"u")throw new Error("This library requires Ease to be loaded first");var{warn:j,error:F,info:M}=ease.log,B=Array.from(document.querySelectorAll('link[rel="component"]')).map(async r=>{let t=await v(r.getAttribute("name"),r.href);x(t),S(t.tagName,t.template,t.style,t.script,t.properties)}),P=Array.from(document.querySelectorAll('link[rel="component-def"]')).map(async r=>fetch(`${r.href}`,{headers:{"x-ease-fetch":"true"}}).then(t=>{if(t.status===404)throw j(`Failed to load component from ${href}`,"URL returned 404").toError();return t.text()}).then(async t=>{let a=new DOMParser().parseFromString(t,"text/xml").querySelector("components"),o=Array.from(a.childNodes).map(async h=>{h.nodeName==="component"&&await v(h.attributes.name.value,h.attributes.href.value).then(s=>{x(s),S(s.tagName,s.template,s.style,s.script,s.properties)}).catch(s=>{F(`Failed to load component from ${h.attributes.href.value}`,s)})});await Promise.all(o),M(`Loaded component definitions from ${r.href}`)}));Promise.all([...B,...P]).then(()=>{let r=document.querySelector("body > template");r&&r.replaceWith(r.content),document.body.classList.add("hydrated")});})();
//# sourceMappingURL=index.min.js.map
