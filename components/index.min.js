(()=>{var q=Object.defineProperty;var j=(n,t)=>{for(var e in t)q(n,e,{get:t[e],enumerable:!0})};var E={};j(E,{EaseAttribute:()=>y,EaseNode:()=>f,EaseNodeParser:()=>p,EaseTextNode:()=>g});var M="http://www.w3.org/2000/svg",y=class{name;value;constructor(t,e){this.name=t,this.value=e}},f=class n{#t;#r;#i;#s;#n={};#e=[];constructor(t,e,o,i=[]){this.#t=t,this.#r=e,this.#e.push(...i),this.#s=o}static fromString(t,e){t=t.replace(">","");let[o,...i]=t.split(" ");o=o.replace("<","").trim();let h=[];i=i.join(" ");let r,l,c=0,u="",s=!1;for(let a=0;a<i.length;a++)if(i[a]==="="&&c===0)r=u,u="",c=1;else if(i[a]==='"')if(c===2){l=u,u="",c=0;let m=new y(r.trim(),l);h.push(m)}else s=!0;else i[a]!=='"'&&c===1?(u+=i[a],c=2):u+=i[a];return o==="svg"?new n(o,h,M):new n(o,h,e)}get parent(){return this.#i}get tag(){return this.#t}get attributes(){return this.#r}get children(){return this.#e}get ns(){return this.#s}get meta(){return this.#n}set meta(t){this.#n=t}get htmlNode(){if(this.meta.htmlNode)return this.meta.htmlNode;let t=this.#s?document.createElementNS(this.#s,this.#t):document.createElement(this.#t);return this.#r.forEach(e=>{t.setAttribute(e.name,e.value.replace(/"/g,""))}),this.#e.forEach(e=>{t.appendChild(e.htmlNode)}),this.meta.htmlNode=t,t}addChild(t){this.#e.push(t),t.setParent(this)}setParent(t){this.#i=t}toString(){return`<${this.#t}${this.#r?.length?" ":""}${this.#r?.map?.(t=>`${t.name}${t.value?`="${t.value}"`:""}`)?.join(" ")||""}>${this.#e.map(t=>t.toString()).join("")}</${this.#t}>`}insertBefore(t,e){let o=this.#e.indexOf(e);if(o===-1)throw new Error("Child not found");this.#e.splice(o,0,t),t.setParent(this)}replaceChild(t,e){let o=this.#e.indexOf(t);if(o===-1)throw new Error("Child not found");this.#e[o]=e,e.setParent(this)}removeChild(t){let e=this.#e.indexOf(t);if(e===-1)throw new Error("Child not found");this.#e.splice(e,1)}remove(){this.parent.removeChild(this)}replace(t){Array.isArray(t)||(t=[t]),t.forEach(e=>{this.parent.insertBefore(e,this)}),this.remove()}addMeta(t,e){this.#n[t]=e}getMeta(t){return this.#n[t]}deleteMeta(t){delete this.#n[t]}clone(){let t=new n(this.#t,this.#r,this.#s);return Object.keys(this.meta).forEach(e=>{t.addMeta(e,this.meta[e])}),this.#e.forEach(e=>{t.addChild(e.clone())}),t}},g=class n extends f{#t;constructor(t){super("#TEXT",[],[]),this.#t=t}get text(){return this.#t}set text(t){this.#t=t}get htmlNode(){if(this.meta.htmlNode)return this.meta.htmlNode;let t=document.createTextNode(this.#t);return this.meta.htmlNode=t,t}toString(){return this.#t}addChild(){throw new Error("Cannot add children to text node")}clone(){let t=new n(this.#t);return Object.keys(this.meta).forEach(e=>{t.addMeta(e,this.meta[e])}),t}},p=class{constructor(){}parse(t){let e=new f("root"),o=e;return t.split(/(<[^>]+>)/).filter(i=>!!i).forEach(i=>{if(!i.startsWith("<!"))if(i.startsWith("</"))o=o.parent;else if(i.startsWith("<")){let h=f.fromString(i,o.ns);o.addChild(h),i.endsWith("/>")||(o=h)}else i.trim().length>0&&o.addChild(new g(i.trim()))}),e}};function A(n){let e=new p().parse(n.match(/<template>([\s\S]*)<\/template>/m)?.[1]||""),o=n.match(/<script>([\s\S]*)<\/script>/m)?.[1]||"",i=n.match(/<style>([\s\S]*)<\/style>/m)?.[1]||"",h=n.match(/<property\s?([^(/>)]+)\/>/g)?.map(r=>{let l=r.match(/name="([^"]+)"/),c=r.match(/type="([^"]+)"/),u=r.match(/default="([^"]+)"/),s=r.match(/required/),a=r.match(/expose-to-styles/),m=r.match(/attribute/),d=l?l[1]:null,T=c?c[1]:null,L=u?u[1]:null,N=s?s[1]==="true":!1;return{name:d,type:T,default:L,required:N,exposeToStyles:!!a,attribute:!!m}})||[];return{template:e,script:o,style:i,properties:h}}if(typeof ease>"u")throw new Error("This library requires Ease to be loaded first");var{warn:G,error:v,info:J}=ease.log,{config:K}=ease,w=new Map;var x=class{template;tagName;script;style;properties;href;constructor(t,e,o,i,h,r){this.href=t,this.template=e,this.tagName=o,this.script=this._scriptBlobFromText(i),this.style=h,this.properties=r}_scriptBlobFromText(t){if(!t)return null;let e=new Blob([t],{type:"text/javascript"});return URL.createObjectURL(e)}};async function b(n,t){if(w.has(n)){let e=w.get(n);if(e.href!==t)throw v(`Component ${n} already exists in the registry with a different href`).toError();return e}return await fetch(`${t}`,{headers:{"x-ease-fetch":"true"}}).then(async e=>({content:await e.text(),code:e.status})).then(({content:e,code:o})=>{if(o!==200)throw v(`Failed to fetch component from ${t}`).toError();let{template:i,script:h,style:r,properties:l}=A(e);return ease.extensions.getExtensionsByArtifact("@easedotjs/components").forEach(([c,u])=>{if(c.onFetchComponent)try{c.onFetchComponent({template:i,script:h,style:r})}catch(s){v(`Failed to run extension ${u} onFetchComponent for ${t}`,s)}}),{template:i,script:h,style:r,properties:l}}).then(({template:e,script:o,style:i,properties:h})=>new x(t,e,n,o,i,h)).catch(e=>{v(`Failed to fetch component from ${t}`)})}function C(n){n&&(w.has(n.tagName)||w.set(n.tagName,n))}if(typeof ease>"u")throw new Error("This library requires Ease to be loaded first");var{config:F,extensions:S}=ease,{error:B}=ease.log;function $(n,t,e,o,i){let h=class extends HTMLElement{#t;#r=!1;#i;#s;eventListeners=[];#n;#e={root:void 0,elements:{},get el(){return this.elements},properties:{},get props(){return this.properties},extensions:{},get ext(){return this.extensions},get[F.inject.name](){return this.extensions},attributes:{},get attrs(){return this.attributes}};constructor(){super();let r=this;this.#t=this.attachShadow({mode:"open"}),this.#e.root=this.#t,this.#n=t.clone()}#o(){let r=this;this.#n.children.forEach(s=>{this.#t.appendChild(s.htmlNode)}),e&&(this.#i=document.createElement("style"),this.#i.textContent=e,this.#t.appendChild(this.#i));let l="";i?.forEach?.(s=>{if(this.#e.properties[s.name]={_listeners:[],_value:s.default,type:s.type,required:s.required,exposeToStyles:s.exposeToStyles,attribute:s.attribute,get value(){return this._value},set value(a){let m=this._value;this._value=a,this._listeners.forEach(d=>d(a,m)),this.exposeToStyles&&r.updateStyles()},watch(a){this._listeners.push(a),this.mounted||a(this.value,void 0)},unwatch(a){this._listeners=_listeners.filter(m=>m!==a)},unwatchAll(){this._listeners=[]}},Object.defineProperty(this,s.name,{get:()=>this.#e.properties[s.name].value,set:a=>{this.#e.properties[s.name].value=a}}),s.required&&s.attribute&&!this.hasAttribute(s.name))throw B(`Attribute ${s.name} is required`).toError();s.attribute&&(this.#e.properties[s.name].value=this.getAttribute(s.name)||s.default),s.exposeToStyles&&(l+=`--${s.name}: ${this.#e.properties[s.name].value}; `)}),l&&(this.#s=document.createElement("style"),this.#s.textContent+=`:host { ${l} }`,this.#t.insertBefore(this.#s,this.#i)),this.#t.querySelectorAll("[id]").forEach(s=>{this.#e.elements[s.id]=s}),this.#e.extensions=S.all.reduce((s,a)=>{let m=a.objects||{},d=a.methods||{};return{...s,...m,...d}},{});let c=this.#t.addEventListener;this.#t.addEventListener=function(s,a){r.eventListeners.push({name:s,callback:a}),c(s,a)};let u=this.#t.removeEventListener;this.#t.removeEventListener=function(s,a){r.eventListeners=r.eventListeners.filter(({name:m,callback:d})=>m===s&&d===a?(u(s,a),!1):!0)},o&&import(o).then(s=>{s.default&&(s.default&&s.default.apply(r,[{...this.#e,self:r}]),this.#t.dispatchEvent(new CustomEvent("connect")))}),S.getExtensionsByArtifact("@easedotjs/components").forEach(([s])=>s.onInit?.({shadow:this.#t,args:this.#e,instance:r})),Array.from(this.attributes).forEach(s=>{this.#e.attributes[s.name]=s.value})}updateStyles(){if(!this.#s)return;let r="";Object.keys(this.#e.properties).forEach(l=>{let c=this?.[l];c.exposeToStyles&&(attrStyles+=`--${l}: ${c.value}; `)}),this.#s.textContent=`:host { ${r} }`}connectedCallback(){this.#o(),this.#r=!0,this.#t.dispatchEvent(new CustomEvent("connect"))}disconnectedCallback(){this.#r=!1,this.#e.properties?.forEach?.(r=>{r.unwatchAll()}),this.#t.dispatchEvent(new CustomEvent("disconnect")),this.eventListeners.forEach(({name:r,callback:l})=>{this.#t.removeEventListener(r,l)}),S.getExtensionsByArtifact("@easedotjs/components").forEach(([r])=>r.onCleanup?.({shadow:this.#t,args:this.#e}))}static get observedAttributes(){return i.filter(r=>r.attribute).map(r=>r.name)}get mounted(){return this.#r}get vdom(){return this.#n}};return customElements.define(n,h),h}if(typeof ease>"u")throw new Error("This library requires Ease to be loaded first");var{warn:O,error:P,info:_}=ease.log,W=Array.from(document.querySelectorAll('link[rel="component"]')).map(async n=>{let t=await b(n.getAttribute("name"),n.href);C(t),$(t.tagName,t.template,t.style,t.script,t.properties)}),R=Array.from(document.querySelectorAll('link[rel="component-def"]')).map(async n=>fetch(`${n.href}`,{headers:{"x-ease-fetch":"true"}}).then(t=>{if(t.status===404)throw O(`Failed to load component from ${href}`,"URL returned 404").toError();return t.text()}).then(async t=>{let o=new DOMParser().parseFromString(t,"text/xml").querySelector("components"),i=Array.from(o.childNodes).map(async h=>{h.nodeName==="component"&&await b(h.attributes.name.value,h.attributes.href.value).then(r=>{C(r),$(r.tagName,r.template,r.style,r.script,r.properties)}).catch(r=>{P(`Failed to load component from ${h.attributes.href.value}`,r)})});await Promise.all(i),_(`Loaded component definitions from ${n.href}`)}));Promise.all([...W,...R]).then(()=>{let n=document.querySelector("body > template");n&&n.replaceWith(n.content),document.body.classList.add("hydrated")});ease.extensions.add({name:"@easedotjs/components",vdom:E});})();
//# sourceMappingURL=index.min.js.map
